
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="WebRTC, 音视频, Rust, Golang, Node">
      
      
        <meta name="author" content="chapin666">
      
      
        <link rel="canonical" href="http://chapin666.github.io/blog/codec/004.html">
      
      
        <link rel="prev" href="003.html">
      
      
        <link rel="next" href="005.html">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.3">
    
    
      
        <title>第四讲：音频自动增益控制 AGC - chapin666</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c4a75a56.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-XC0L0QGG63"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-XC0L0QGG63",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-XC0L0QGG63",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="black">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#agc" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../index.html" title="chapin666" class="md-header__button md-logo" aria-label="chapin666" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            chapin666
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第四讲：音频自动增益控制 AGC
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../aigc/sd/001.html" class="md-tabs__link">
        AIGC
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="001.html" class="md-tabs__link md-tabs__link--active">
        AVCodec
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../webrtc/forcurious/001.html" class="md-tabs__link">
        WebRTC
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../rust/fromzero/001.html" class="md-tabs__link">
        Rust
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="chapin666" class="md-nav__button md-logo" aria-label="chapin666" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5Z"/></svg>

    </a>
    chapin666
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          AIGC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          AIGC
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          Stable Diffusion
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Stable Diffusion
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aigc/sd/001.html" class="md-nav__link">
        硬核解读Stable Diffusion（1）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aigc/sd/002.html" class="md-nav__link">
        硬核解读Stable Diffusion（2）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aigc/sd/003.html" class="md-nav__link">
        硬核解读Stable Diffusion（3）
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          AVCodec
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          AVCodec
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          音视频基础系列
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          音视频基础系列
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="001.html" class="md-nav__link">
        第一讲：音频要素
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="002.html" class="md-nav__link">
        第二讲：回声消除
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="003.html" class="md-nav__link">
        第三讲：噪声抑制
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          第四讲：音频自动增益控制 AGC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="004.html" class="md-nav__link md-nav__link--active">
        第四讲：音频自动增益控制 AGC
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agc" class="md-nav__link">
    实际场景的音量问题和AGC的必要性
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    什么是音量
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    音量“增益”的本质是什么
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agc_1" class="md-nav__link">
    AGC进行音量增益“自动控制”的策略是什么
  </a>
  
    <nav class="md-nav" aria-label="AGC进行音量增益“自动控制”的策略是什么">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1 固定数字增益策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 自适应模拟增益策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3 自适应数字增益策略
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    总结
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    思考题
  </a>
  
    <nav class="md-nav" aria-label="思考题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    上期思考题揭秘
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    本期思考题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="005.html" class="md-nav__link">
        第五讲：音频编解码的必要性解读与格式选取
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="006_1.html" class="md-nav__link">
        第六讲：色彩和色彩空间·上篇
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="006_2.html" class="md-nav__link">
        第六讲：色彩和色彩空间·中篇
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="006_3.html" class="md-nav__link">
        第六讲：色彩和色彩空间·下篇
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="007_1.html" class="md-nav__link">
        第七讲：分辨率与帧率·上篇
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          WebRTC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          WebRTC
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          写给好奇者的webrtc系列
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          写给好奇者的webrtc系列
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/001.html" class="md-nav__link">
        是什么，为什么，如何使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/002.html" class="md-nav__link">
        信令
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/003.html" class="md-nav__link">
        连接
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/004.html" class="md-nav__link">
        安全性
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/005.html" class="md-nav__link">
        实时网络
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/006.html" class="md-nav__link">
        媒体通信
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/007.html" class="md-nav__link">
        数据通信
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/008.html" class="md-nav__link">
        应用场景
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/009.html" class="md-nav__link">
        调试
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/010.html" class="md-nav__link">
        历史
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/011.html" class="md-nav__link">
        常见问题
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/012.html" class="md-nav__link">
        术语
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/forcurious/013.html" class="md-nav__link">
        Reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          WebRTC构建实时通信系列
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          WebRTC构建实时通信系列
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/jsapi/001.html" class="md-nav__link">
        概述及环境搭建（一）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/jsapi/002.html" class="md-nav__link">
        从摄像头获取视频流（二）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/jsapi/003.html" class="md-nav__link">
        RTCPeerConnection传输视频流（三）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/jsapi/004.html" class="md-nav__link">
        RTCDataChannel交换数据（四）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/jsapi/005.html" class="md-nav__link">
        搭建信令服务交换消息（五）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/jsapi/006.html" class="md-nav__link">
        对等连接和信令整合（六）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/jsapi/007.html" class="md-nav__link">
        data channel共享照片（七）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../webrtc/jsapi/008.html" class="md-nav__link">
        总结（八）
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Rust
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Rust
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
      
      
      
        <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
          从零蛋开始学Rust
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          从零蛋开始学Rust
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/001.html" class="md-nav__link">
        01-语言简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/002.html" class="md-nav__link">
        02-开发环境配置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/003.html" class="md-nav__link">
        03-Hello World
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/004.html" class="md-nav__link">
        04-数据类型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/005.html" class="md-nav__link">
        05-变量
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/006.html" class="md-nav__link">
        06-常量
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/007.html" class="md-nav__link">
        07-字符串
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/008.html" class="md-nav__link">
        08-运算符
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/009.html" class="md-nav__link">
        09-条件判断
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/010.html" class="md-nav__link">
        10-循环语句
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/011.html" class="md-nav__link">
        11-函数
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/012.html" class="md-nav__link">
        12-元组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/013.html" class="md-nav__link">
        13-数组
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/014.html" class="md-nav__link">
        14-所有权
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/015.html" class="md-nav__link">
        15-借用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/016.html" class="md-nav__link">
        16-切片
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/017.html" class="md-nav__link">
        17-结构体
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/018.html" class="md-nav__link">
        18-枚举
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/019.html" class="md-nav__link">
        19-模块
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/020.html" class="md-nav__link">
        20-容器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/021.html" class="md-nav__link">
        21-错误处理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/022.html" class="md-nav__link">
        22-泛型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/023.html" class="md-nav__link">
        23-IO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/024.html" class="md-nav__link">
        24-文件读写
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/025.html" class="md-nav__link">
        25-Cargo包管理器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/026.html" class="md-nav__link">
        26-迭代器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/027.html" class="md-nav__link">
        27-闭包
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/028.html" class="md-nav__link">
        28-智能指针
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rust/fromzero/029.html" class="md-nav__link">
        29-多线程并发编程
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agc" class="md-nav__link">
    实际场景的音量问题和AGC的必要性
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    什么是音量
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    音量“增益”的本质是什么
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agc_1" class="md-nav__link">
    AGC进行音量增益“自动控制”的策略是什么
  </a>
  
    <nav class="md-nav" aria-label="AGC进行音量增益“自动控制”的策略是什么">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1 固定数字增益策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 自适应模拟增益策略
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3 自适应数字增益策略
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    总结
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    思考题
  </a>
  
    <nav class="md-nav" aria-label="思考题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    上期思考题揭秘
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    本期思考题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  




  <h1>第四讲：音频自动增益控制 AGC</h1>

<p>在之前的文章中，我们已经接触了两个重要的音频前处理模块 – 回声消除 AEC 和噪声抑制 ANS，它们分别解决了 RTC 场景下的回声、噪声问题，极大提升了用户的体验。至此，音频前处理三剑客中，就只剩下一位 – <strong>音频自动增益控制 <a href="#">AGC</a></strong>（Automatic Gain Control）还没有介绍，今天我们就来认识一下它。</p>
<h2 id="agc">实际场景的音量问题和AGC的必要性</h2>
<p>相较于回声和噪声，音量相关的问题似乎不怎么“严重”，如果排除播放端误操作的因素，实际场景中还会有哪些音量问题？什么情况下我们会有“需要调整音量”的想法呢？</p>
<p><strong>情况一：音量太小，我们无法辨识具体的语音信息</strong>，甚至需要贴着扬声器、皱着眉头“聆听”。原因可能是讲话者距离麦克风过远，也可能是麦克风的采集音量就比较小；</p>
<p><strong>情况二：音量太大，我们的耳朵遭受“痛击”</strong>，不得不对扬声器“敬而远之”。原因可能是讲话者距离麦克风过近、可能其说话本身就比较“用力”。</p>
<p><strong>情况三：音量忽大忽小，一段语音里可能同时存在前述两个问题</strong>，音量起起伏伏、若即若离，对听众来说无疑也是一种”折磨”。</p>
<p>对于这些音量问题，除了让讲话者调整与麦克风的距离、自身说话的声音大小外，我们熟知且习惯的解决办法是：在采集端，调节麦克风的采集增益；在播放端，调节播放软件的音量条、或者设备扬声器的播放增益。</p>
<p><a href="images/004_1.png" title="采集音量控制"><img alt="图片" src="images/004_1.png" /></a></p>
<p><a href="images/004_2.png" title="播放音量控制"><img alt="图片" src="images/004_2.png" /></a></p>
<p>这些手动的操作，其实都还算得上立竿见影。这么一看，既然动动手就可以自行解决，音量问题貌似的确不是什么大问题，为什么还需要自动增益控制呢？</p>
<p>我们需要意识到，“动动手”这种被动的音量调节方式，虽然有一定效果，但“不够便捷”，也“众口难调”。实际场景中，环境复杂多变：说话者不同则声音的原始音量有差异，说话者距离麦克风远近不同则声音传播的衰减有差异，麦克风设备不同则采集的增益有差异。</p>
<p>这些差异，使得一次“手动调节”很难适应采集环境的动态变化，如果场景中存在多个用户使用同一个麦克风的情况，更难一一兼顾。对于不熟悉设备系统的用户来说，如何调节设备采集增益、调节到多少合适或许都是“不可能完成的任务”（你知道如何调节PC端的麦克风增益吗？）。如果只依赖于手动调节，尤其是频繁的手动调节，势必会给用户带来负担，影响体验，对于产品设计来说也不够“优雅”。</p>
<p>此时，一个智能的音量调节机制的必要性就体现出来了。</p>
<p><strong>AGC 针对上述情况，会自动调节采集端的音量“增益补偿”</strong>。简单来说，如果讲话者的声音过大， AGC 会自动降低增益；反之，会自动提高增益，以确保音量维持在一个比较稳定的水平。这个过程，用户无需频繁操作设备，就能避免声音起伏导致的不良体验，可以专注于 RTC 的音视频交互。</p>
<p>了解了常见的音量问题，以及 AGC 在解决这些问题上的优势，大家应该能领会到 AGC 存在的合理性和必要性，是时候再进一步了解下其中的技术点了。所谓“音量自动增益控制”，想要做具体了解，我们不妨把它拆解一下，逐个击破：</p>
<ul>
<li>什么是“音量”？</li>
<li>音量“增益”的本质是什么？</li>
<li>AGC进行音量增益“自动控制”的策略是什么？</li>
</ul>
<p>我们接下来就一一解答这些问题。</p>
<h2 id="_1">什么是音量</h2>
<p>在探讨 ANS、AEC 的文章中，我们都会先理清相应模块的处理对象，比如噪声是什么、回声是什么。所谓知己知彼，AGC 也不例外，我们需要先知道：究竟什么是音量？</p>
<p>其实，在系列文章的第一讲 – 音频要素中，我们就接触了音量的概念，只不过使用的是另外一个名称：响度。</p>
<p>我们回忆一下响度的定义：“响亮、微弱，是对声音强弱的感觉描述，这种特征被称为响度。响度由发声体振动的幅度决定，当传播的距离相同时，振动幅度越大、则响度越大；相反，当振幅一定时，传播距离越远，响度越小，就是我们常说的“距离太远了，听不见”的原因。“音量、响度”描述的是声音的同一属性，从定义上来看，它们是人耳对声音强弱的“感受”，主要由声音振动的“幅度”决定。感受是一种“心理量”，无法被具体量化；而振幅是“物理量”，在音频采样位深为 16bit 时，其幅度取值为 [-32768,32767]，范围非常大，不便于检测和计算（关于采样位深和幅度的概念，可参考系列文章的第一讲–<a href="001.html">音频要素–声音的采集与量化</a>）。</p>
<p>为了简化表示，我们又引入其他计量标准来表示音量，常见的有“声压级”标准和“全分贝刻度”标准，二者使用的单位均为分贝（dB）。</p>
<p>分贝是一个对数单位, 用于表示两个相同单位物理量的比，所以它需要参考一个基准量来进行计算，基准量不同，得到的数值体系也不同：</p>
<ul>
<li><strong>声压级（SPL，Sound Pressure Levels）</strong>：单位为 dBSPL。使用声压作为基准量，其基准值为 20 μPa （声音在空气中振动会引起大气压强的变化，也即“声压“，单位为 Pa 。20 μPa 是人耳在频率1KHz下能感知的最小声音，相当于三米外一只蚊子的声音）。我们把声压为 20 μPa 的音量记为 0 dBSPL，音量越大，声压级分贝越大。我们正常谈话聊天的声压级音量约为 40 ~ 60 dBSPL，如果音量达到 90dBSPL 以上会损伤听力，190 dBSPL 以上甚至会危及生命。常见的噪声等级划分，就使用了声压级参考系。</li>
<li><strong>全分贝刻度（DFS，Decibels Full Scale）</strong>：单位为dBFS。使用音频采样点的幅度值作为基准量。和声压级不同，全分贝刻度的基准值不是最小值，而是最大值。比如，对于采样位深为16bit的音频，音频采样点的最大振幅为32768，此时音量最大。我们取振幅 32768 作为基准量，对应全分贝刻度 0 dBFS，0 dBFS 也即全分贝刻度标准下的最大音量，除了最大音量外都是负值，16bit下的最小值为 -96 dBFS。数字设备、数字音频处理均使用全分贝刻度作为音量单位，AGC 处理也是如此。</li>
</ul>
<p>通过上面的描述，大家对于“什么是音量？”，应该有了初步的认知，有兴趣的同学，还可以具体去了解不同音量标准的对数计算公式，有助于大家进一步理解“分贝”的概念。</p>
<p>接下来，我们继续“音量自动增益控制“ 概念逐个击破的第二部分：音量“增益”的本质。</p>
<h2 id="_2">音量“增益”的本质是什么</h2>
<p>“增益”指的是放大一定倍数，音量“增益”简而言之就是将音量放大一定倍数。</p>
<p>我们已经知道，决定音量大小的物理量为“振幅”，如果能对“振幅”进行调节，其实也就调节了音量。所以，“将音量放大一定倍数”实际上是“将音频采样点的幅值放大一定倍数”，实现上就是将音频采样点的幅值乘上一个系数，系数小于 1，就是缩小幅值，大于 1 就是放大幅值。</p>
<p>需要注意的是，幅值的放大倍数和人耳的听觉感受并不统一，更不成线性关系。也就是说，幅值放大一倍，人耳的听感并没有相应的也放大一倍。针对这种涉及两个物理量比值的非线性关系，我们仍可以借助分贝来处理。</p>
<p>音频采样位深 16bit 下，振幅为 A1 的音频相对于振幅为 A2 的音频，其音量的增益为 ：dB = 20 * log10（A1/A2）。</p>
<ul>
<li>假设采样点幅值放大为2倍（A1/A2 = 2），则该声音被增益了 20*log10(2) ≈ 6dB</li>
<li>假设采样点幅值不变（A1/A2 = 1），则该声音被增益了 20*log10(1) = 0dB</li>
<li>假设采样点幅值缩小为1/2（A1/A2 = 1/2），则该声音增益了 20*log10(1/2) ≈ -6dB</li>
</ul>
<p>若增益为正数，表示对音量做放大处理；反之增益为负数时，表示对音量做缩小处理；增益为 0dB 表示使用原始的音量（大家需要注意，虽然都是 0dB，但不要混淆 音量大小 和 音量增益）。使用 dB 来进行增益计算，就和使用全分贝刻度作为音量大小单位联系起来了。</p>
<p>基于对音量增益本质的了解，我们进一步了解一下<strong>常见的音量增益途径</strong>：模拟增益和数字增益。两种增益途径的具体细节就不做展开，结合已知的基础知识，大家只需要简单了解如下：</p>
<ul>
<li>
<p><strong>模拟增益</strong>：调整连续模拟信号的波形幅度，一般依赖于设备系统接口，控制设备硬件的采集增益，调节系统采集音量</p>
</li>
<li>
<p><strong>数字增益</strong>：调整离散数字信号的采样点幅值，不依赖于设备系统接口，不调节系统采集音量</p>
</li>
</ul>
<p>一般来说，Windows 和 Mac 端普遍支持模拟增益调节，这些平台往往会采用模拟增益 + 数字增益结合的策略调节音量。其中 Windows 端因采集声卡种类繁多，有些声卡的采集音量极小，如果不做系统音量的模拟增益、直接做数字增益，可能会因精度不够，导致数字增益后音质不佳。而移动端（iOS、Android）、Linux 端一般没有调节系统采集音量的接口，无法进行模拟增益调节，只能依赖于数字增益。</p>
<p>当然，只有两种基本的增益方式是无法满足复杂多变的实际场景的，AGC 算法需要根据平台差异和实际需求，灵活选择/搭配上述两种方式，并以此作为基础进一步制定处理策略。这也就是我们 AGC 概念逐个击破的第三部分内容：AGC 进行音量增益“自动控制”的策略是什么？</p>
<h2 id="agc_1">AGC进行音量增益“自动控制”的策略是什么</h2>
<p>在了解 AGC “自动控制”的策略之前，我们先对其处理的音量对象做进一步明确。</p>
<p>显然，并不是所有信号都要进行音量增益控制的，和 ANS/AEC 只抑制噪声/远端回声、要保留近端语音一样，AGC 也要针对采集信号中的近端语音做甄别，避免对噪声、回声等无关信号的增益。考虑这点，把 AGC 模块放在 AEC、ANS 处理之后就比较合适，因为此时信号中的噪声和回声已经被极大的削减。</p>
<p>但位置的“优势”，不代表 AGC 就可以毫无顾虑的开展工作。为避免漏网之鱼，往往需要进行人声检测（VAD），进一步区分语音段和无话段。一般来说，VAD 算法在信噪比低的时候准确性也会降低，为解决这类问题，可以增加谐波检测，通过检测谐波特征量来辅助甄别人声，进一步保证后续 AGC 处理的效果。</p>
<p><a href="images/004_3.png" title="人声检测"><img alt="图片" src="images/004_3.png" /></a></p>
<p>明确了AGC处理的音量对象，我们这就开始了解其开展“自动控制”的策略。</p>
<p>任何策略的制定都要基于明确的目标和限制，围绕这些目标和限制才能保证策略得到准确、有条理的实施，对于 AGC 来说，其遵循的目标和限制主要为（参考经典的 WebRTC-AGC 算法）：</p>
<ul>
<li><strong>目标音量</strong>：表示音量调节的目标大小，使用全分贝刻度标准。比如设置输出音量的目标值为 -3dB;</li>
<li><strong>增益能力</strong>：表示音量调节的最大增益，使用分贝度量方式。比如设置最大增益为12dB，也即可将幅值最高放大4倍；</li>
<li><strong>压限开关</strong>：表示是否使用压限逻辑。是否对超过目标音量的部分进行抑制。</li>
</ul>
<p>基于上述目标和限制，常见的 AGC 策略主要有如下几种（参考经典的 WebRTC-AGC 算法）：</p>
<h3 id="1">1 固定数字增益策略</h3>
<p>首先是最基本的控制策略：固定数字增益策略。该策略的核心逻辑，就是<strong>对音频音量做固定的、不超过所设增益能力的数字增益调节，且调节后的音量需低于目标音量（若使用压限逻辑</strong>）。</p>
<p>固定数字增益的整体策略相对简单，但其缺点也比较明显。由于增益量固定，<strong>缺少反馈调节机制</strong>，对于音量持续较小的信号改善有限；而对于音量持续较大的信号，如果增益能力设置不合理，可能导致噪声音量相对语音部分提升更多（因为语音音量会受目标音量的限制，而噪声一般达不到压限标准），处理后噪声变得相对更明显，这种情况在前序的 ANS 处理不完善时，会尤为严重。</p>
<p>发现了问题，自然就要思考解决方案，一方面是优化前序的噪声消除模块；另一方面，既然是增益固定引入的缺陷，我们可以增加一些动态调整的机制。</p>
<h3 id="2">2 自适应模拟增益策略</h3>
<p>第二种控制策略 “自适应模拟增益”，在固定数字增益策略的基础上，<strong>利用反馈机制，增加了对当前设备模拟增益值的控制</strong>。</p>
<p>它会综合对前序调节效果的评估，分析当前的模拟增益值是否合理，并计算出所需的模拟增益值，再调用系统接口将“所需的模拟增益”设置到设备层，调节原始的采集音量，作用于后续的处理。</p>
<p>该策略的好处是，固定数字增益和动态模拟增益相辅相成，利用反馈机制提高了策略的灵活性、以及均衡效果。但由于模拟增益需要调用系统接口，如果信号比较复杂、调整比较频繁，会产生额外的性能消耗。另外，<strong>该策略不适用于缺少相关系统接口的移动设备，局限性也比较大</strong>。</p>
<h3 id="3">3 自适应数字增益策略</h3>
<p>为解决自适应模拟增益存在的部分问题，并继承其反馈机制的优点，第三种控制策略应运而生 –自适应数字增益。</p>
<p>自适应数字增益策略，在数字增益控制中参考了模拟增益的原理。并同样使用基于反馈机制的调节逻辑，会根据前序处理效果、动态调节数字增益参数，持续优化增益效果。由于只进行数字增益，不依赖于系统接口，<strong>可以应用于移动设备，适用范围更广</strong>。</p>
<p>但遗憾的是，自适应数字增益策略也<strong>存在缺点 – 灵敏度不足，增益调节速度不够快</strong>。在音量起伏频繁时，可能会将用于小音量的大增益，误用于大音量、或者将用于大音量的小增益，误用于小音量，导致大音量更大、小音量更小。</p>
<p><a href="images/004_4.png" title="控制模式"><img alt="图片" src="images/004_4.png" /></a></p>
<h2 id="_3">总结</h2>
<p>了解了 AGC 常见的处理策略及其优劣势，可以发现没有哪一个策略是绝对完美的，需要取长补短、合理搭配，并且不断的总结精进。设计一个优秀的 AGC 算法，也是任重道远的。</p>
<p>现在，AGC 自动增益控制的各个概念要点，我们已经逐一击破了，今后在实际应用中再遇到音量问题，我们不应仅仅满足于“动动手”，还可以进一步借助 AGC 模块来解决，对于 AGC 处理不佳的情况，也可以尝试探究其原因和优化方案，进一步加深理解。</p>
<p>至此，致力于让声音更“好听”的音频前处理三剑客，已经和大家介绍完毕了，在当今的 RTC 场景下，3A 处理已然是不可或缺的一环，我们很难想象，再回到充斥着回声、噪声、音量还起伏不定的环境会是一种怎样的“折磨”，用户体验无从谈起，恐怕再优秀有趣的玩法都无济于事。</p>
<p>在未来，随着 RTC 场景的不断扩展，我们必然会遇到更多的技术挑战，但我们有理由相信，随着技术应用的不断深入，业界势必也会有更优秀、更智能的 3A 算法落地，会持续为我们的用户体验保驾护航，我们大可以拭目以待！</p>
<p>下面，我们再通过一个思维导图，梳理一下整篇文章的内容：</p>
<p><a href="images/004_5.png"><img alt="图片" src="images/004_5.png" /></a></p>
<p><a href="images/004_6.png"><img alt="图片" src="images/004_6.png" /></a></p>
<h2 id="_4">思考题</h2>
<h3 id="_5">上期思考题揭秘</h3>
<p>问</p>
<p>噪声抑制可能会损伤“有用信号”，这一现象在音乐场景尤为明显，原因是什么呢？</p>
<p>答</p>
<p>《无间道》中有一句经典台词：“高音甜、中音准、低音沉，总之一句话就是通透”，大概是对“好听”最贴切的描述之一。这里的“高音、中音、低音” 是指声音的不同频率。一段悦耳的音乐，在每个频段上（尤其是高频部分）都有着丰富的细节，任何频段的损失都可能影响听感。但是，音乐在中高频（尤其是高频）部分的能量往往较低，这就导致叠加噪声之后，信噪比很小，给ANS处理带来难度。中高频的音乐细节很可能被误当做噪声处理掉，造成损伤。相比之下，人声一般集中在中低频，能量、信噪比也较高，在 ANS 处理中的损伤会相对少。  </p>
<p>综上，音乐更容易被 ANS 误伤，在有高音质要求的音乐场景，建议降低降噪等级，甚至关闭降噪处理，尽可能从环境层面降低噪声干扰。</p>
<h3 id="_6">本期思考题</h3>
<p>谐波检测为什么可以用于辅助定位人声，提高 VAD 的准确度？</p>
<p>（我们下期揭秘）</p>


  




<h2 id="__comments">评论</h2>
<!-- Insert generated snippet here -->
<script src="https://giscus.app/client.js" data-repo="chapin666/blog" data-repo-id="MDEwOlJlcG9zaXRvcnk5MTc1MTUyMg=="
    data-category="Announcements" data-category-id="DIC_kwDOBXgEYs4CVK0Q" data-mapping="pathname" data-strict="0"
    data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme"
    data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async>
    </script>

<!-- Synchronize Giscus theme with palette -->
<script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        giscus.setAttribute("data-theme", theme)
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function () {
        var ref = document.querySelector("[data-md-component=palette]")
        ref.addEventListener("change", function () {
            var palette = __md_get("__palette")
            if (palette && typeof palette.color === "object") {
                var theme = palette.color.scheme === "slate" ? "dark" : "light"

                /* Instruct Giscus to change theme */
                var frame = document.querySelector(".giscus-frame")
                frame.contentWindow.postMessage(
                    { giscus: { setConfig: { theme } } },
                    "https://giscus.app"
                )
            }
        })
    })
</script>

                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="003.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: 第三讲：噪声抑制" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  上一页
                </span>
                第三讲：噪声抑制
              </div>
            </div>
          </a>
        
        
          
          <a href="005.html" class="md-footer__link md-footer__link--next" aria-label="下一页: 第五讲：音频编解码的必要性解读与格式选取" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  下一页
                </span>
                第五讲：音频编解码的必要性解读与格式选取
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 chapin666
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/chapin666" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.zhihu.com/people/chapin666" target="_blank" rel="noopener" title="www.zhihu.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5.721 0C2.251 0 0 2.25 0 5.719V18.28C0 21.751 2.252 24 5.721 24h12.56C21.751 24 24 21.75 24 18.281V5.72C24 2.249 21.75 0 18.281 0zm1.964 4.078c-.271.73-.5 1.434-.68 2.11h4.587c.545-.006.445 1.168.445 1.171H9.384a58.104 58.104 0 0 1-.112 3.797h2.712c.388.023.393 1.251.393 1.266H9.183a9.223 9.223 0 0 1-.408 2.102l.757-.604c.452.456 1.512 1.712 1.906 2.177.473.681.063 2.081.063 2.081l-2.794-3.382c-.653 2.518-1.845 3.607-1.845 3.607-.523.468-1.58.82-2.64.516 2.218-1.73 3.44-3.917 3.667-6.497H4.491c0-.015.197-1.243.806-1.266h2.71c.024-.32.086-3.254.086-3.797H6.598c-.136.406-.158.447-.268.753-.594 1.095-1.603 1.122-1.907 1.155.906-1.821 1.416-3.6 1.591-4.064.425-1.124 1.671-1.125 1.671-1.125zM13.078 6h6.377v11.33h-2.573l-2.184 1.373-.401-1.373h-1.219zm1.313 1.219v8.86h.623l.263.937 1.455-.938h1.456v-8.86z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.path", "navigation.top", "toc.follow", "search.share", "header.autohide", "content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../assets/javascripts/bundle.efa0ade1.min.js"></script>
      
    
  </body>
</html>